(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66102135"],{"17eb4":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));var r=a("b775");function n(e){return Object(r["b"])({url:"/proxy-channel",method:"post",data:e})}function i(e){return Object(r["b"])({url:"/proxy-channel/list",method:"post",data:e})}},"1f23":function(e,t,a){},"76fe":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"h",(function(){return o})),a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return c})),a.d(t,"f",(function(){return l})),a.d(t,"g",(function(){return u})),a.d(t,"c",(function(){return d}));var r=a("b775");function n(e){return Object(r["b"])({url:"/job",method:"post",data:e})}function i(e){return Object(r["b"])({url:"/job/".concat(e),method:"get"})}function o(e){return Object(r["b"])({url:"/job/stop/".concat(e),method:"post"})}function s(e){return Object(r["b"])({url:"/job/pause/".concat(e),method:"post"})}function c(e){return Object(r["b"])({url:"/job/restart/".concat(e),method:"post"})}function l(e){return Object(r["b"])({url:"/job/search",method:"post",data:e})}function u(e){return Object(r["b"])({url:"/job-record/search",method:"post",data:e})}function d(e){return Object(r["b"])({url:"/job/get-stat-info/".concat(e),method:"get"})}},"85ee":function(e,t,a){(function(t){var a=1/0,r=9007199254740991,n="[object Arguments]",i="[object Function]",o="[object GeneratorFunction]",s="[object Symbol]",c="object"==typeof t&&t&&t.Object===Object&&t,l="object"==typeof self&&self&&self.Object===Object&&self,u=c||l||Function("return this")();function d(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}function p(e,t){var a=-1,r=e?e.length:0,n=Array(r);while(++a<r)n[a]=t(e[a],a,e);return n}function m(e,t){var a=-1,r=t.length,n=e.length;while(++a<r)e[n+a]=t[a];return e}var f=Object.prototype,h=f.hasOwnProperty,b=f.toString,g=u.Symbol,v=f.propertyIsEnumerable,y=g?g.isConcatSpreadable:void 0,x=Math.max;function S(e,t,a,r,n){var i=-1,o=e.length;a||(a=F),n||(n=[]);while(++i<o){var s=e[i];t>0&&a(s)?t>1?S(s,t-1,a,r,n):m(n,s):r||(n[n.length]=s)}return n}function w(e,t){return e=Object(e),k(e,t,(function(t,a){return a in e}))}function k(e,t,a){var r=-1,n=t.length,i={};while(++r<n){var o=t[r],s=e[o];a(s,o)&&(i[o]=s)}return i}function C(e,t){return t=x(void 0===t?e.length-1:t,0),function(){var a=arguments,r=-1,n=x(a.length-t,0),i=Array(n);while(++r<n)i[r]=a[t+r];r=-1;var o=Array(t+1);while(++r<t)o[r]=a[r];return o[t]=i,d(e,this,o)}}function F(e){return D(e)||j(e)||!!(y&&e&&e[y])}function O(e){if("string"==typeof e||P(e))return e;var t=e+"";return"0"==t&&1/e==-a?"-0":t}function j(e){return V(e)&&h.call(e,"callee")&&(!v.call(e,"callee")||b.call(e)==n)}var D=Array.isArray;function _(e){return null!=e&&N(e.length)&&!z(e)}function V(e){return I(e)&&_(e)}function z(e){var t=T(e)?b.call(e):"";return t==i||t==o}function N(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function T(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function I(e){return!!e&&"object"==typeof e}function P(e){return"symbol"==typeof e||I(e)&&b.call(e)==s}var R=C((function(e,t){return null==e?{}:w(e,p(S(t,1),O))}));e.exports=R}).call(this,a("2409"))},"8f29":function(e,t,a){"use strict";a("1f23")},a316:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-card",{attrs:{bordered:!1}},[r("div",{staticClass:"table-page-search-wrapper"},[r("a-form",{attrs:{layout:"inline"}},[r("a-row",{attrs:{gutter:48}},[r("a-col",{attrs:{md:8,sm:24}},[r("a-form-item",{attrs:{label:"蜘蛛名"}},[r("a-input",{attrs:{placeholder:""},model:{value:e.searchModel.name,callback:function(t){e.$set(e.searchModel,"name",t)},expression:"searchModel.name"}})],1)],1),e.advanced?[r("a-col",{attrs:{md:8,sm:24}},[r("a-form-item",{attrs:{label:"表名"}},[r("a-input",{attrs:{placeholder:""},model:{value:e.searchModel.tableName,callback:function(t){e.$set(e.searchModel,"tableName",t)},expression:"searchModel.tableName"}})],1)],1)]:e._e(),r("a-col",{attrs:{md:e.advanced?24:8,sm:24}},[r("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[r("a-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),r("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return e.searchModel={}}}},[e._v("重置")]),r("a",{staticStyle:{"margin-left":"8px"},on:{click:e.toggleAdvanced}},[e._v("\n              "+e._s(e.advanced?"收起":"展开")+"\n              "),r("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)])],2)],1)],1),r("div",{staticClass:"table-operator"},[r("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.openCreateSpider}},[e._v("新建")]),r("a-button",{attrs:{icon:"plus",type:"primary",ghost:""},on:{click:function(t){e.importVisible=!0}}},[e._v("导入配置")])],1),r("a-table",{attrs:{columns:e.columns,rowKey:function(e){return e.id},dataSource:e.data,pagination:e.pagination,loading:e.loading},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"proxy",fn:function(t,a){return[e._v("\n      "+e._s(a.proxyChannelId?e.proxies.find((function(e){return e.id===a.proxyChannelId})).alias:"-")+"\n    ")]}},{key:"action",fn:function(t,a){return[r("a-popconfirm",{staticClass:"m-b-8",attrs:{title:"任务将提交到后台运行, 确认运行?",okText:"确认",cancelText:"取消"},on:{confirm:function(t){return e.runSpider(a)}}},[r("a-icon",{staticStyle:{color:"red"},attrs:{slot:"icon",type:"question-circle-o"},slot:"icon"}),r("a-button",{staticClass:"m-r-8",attrs:{type:"primary",size:"small"}},[e._v("运行")])],1),r("a-button",{staticClass:"m-r-8 m-b-8",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.optimizeSpider(a)}}},[e._v("设置运行参数")]),r("a-button",{staticClass:"m-r-8 m-b-8",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.configSpiderProxy(a)}}},[e._v("配置代理")]),r("a-button",{staticClass:"m-r-8 m-b-8",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goPage("/spider/jobList?spiderName="+a.name+"&spiderTableName="+a.tableName)}}},[e._v("查看任务")]),r("a-button",{staticClass:"m-r-8 m-b-8",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.copySpiderConfig(a)}}},[e._v("导出配置")]),r("a-button",{staticClass:"m-r-8 m-b-8",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.modifySpiderConfig(a)}}},[e._v("修改")]),r("a-button",{staticClass:"m-r-8 m-b-8",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.cloneSpiderConfig(a)}}},[e._v("克隆")]),r("a-popconfirm",{attrs:{title:"确认删除?",okText:"确认",cancelText:"取消"},on:{confirm:function(t){return e.deleteSpider(a)}}},[r("a-icon",{staticStyle:{color:"red"},attrs:{slot:"icon",type:"question-circle-o"},slot:"icon"}),r("a-button",{staticClass:"m-r-8",attrs:{type:"danger",size:"small"}},[e._v("删除")])],1)]}}])}),r("a-modal",{attrs:{title:"设置运行参数",width:"50%",maskClosable:!1,visible:e.optimizeDialog},on:{ok:e.doOptimizeSpider,cancel:function(t){e.optimizeDialog=!1}}},[r("a-form",{attrs:{form:e.optimizeSpiderForm}},[r("a-form-item",{attrs:{label:"线程数","label-col":{span:8},"wrapper-col":{span:12}}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["threadNum",{rules:[{required:!0,message:"请输入线程数"}],initialValue:e.optimizeSpiderForm.threadNum}],expression:"['threadNum', {rules: [{ required: true, message: '请输入线程数' }], initialValue: optimizeSpiderForm.threadNum}]"}]})],1),r("a-form-item",{attrs:{label:"页面处理完后的睡眠时间（秒）","label-col":{span:8},"wrapper-col":{span:12}}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["sleepTime",{rules:[{required:!0,message:"请输入每个页面处理完后的睡眠时间"}],initialValue:e.optimizeSpiderForm.sleepTime}],expression:"['sleepTime', {rules: [{ required: true, message: '请输入每个页面处理完后的睡眠时间' }], initialValue: optimizeSpiderForm.sleepTime}]"}]})],1),r("a-form-item",{attrs:{label:"页面下载失败重试次数","label-col":{span:8},"wrapper-col":{span:12}}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["retryTimes",{rules:[{required:!0,message:"请输入页面下载失败重试次数"}],initialValue:e.optimizeSpiderForm.retryTimes}],expression:"['retryTimes', {rules: [{ required: true, message: '请输入页面下载失败重试次数' }], initialValue: optimizeSpiderForm.retryTimes}]"}]})],1),r("a-form-item",{attrs:{label:"重试睡眠时间（秒）","label-col":{span:8},"wrapper-col":{span:12}}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["retrySleepTime",{rules:[{required:!0,message:"请输入重试睡眠时间"}],initialValue:e.optimizeSpiderForm.retrySleepTime}],expression:"['retrySleepTime', {rules: [{ required: true, message: '请输入重试睡眠时间' }], initialValue: optimizeSpiderForm.retrySleepTime}]"}]})],1),r("a-form-item",{attrs:{label:"页面爬取失败后放回队列的次数","label-col":{span:8},"wrapper-col":{span:12}}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["cycleRetryTimes",{rules:[{required:!0,message:"请输入页面爬取失败后放回队列的次数"}],initialValue:e.optimizeSpiderForm.cycleRetryTimes}],expression:"['cycleRetryTimes', {rules: [{ required: true, message: '请输入页面爬取失败后放回队列的次数' }], initialValue: optimizeSpiderForm.cycleRetryTimes}]"}]})],1),r("a-form-item",{attrs:{label:"下载页面超时时间（秒）","label-col":{span:8},"wrapper-col":{span:12}}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["timeOut",{rules:[{required:!0,message:"请输入下载页面超时时间"}],initialValue:e.optimizeSpiderForm.timeOut}],expression:"['timeOut', {rules: [{ required: true, message: '请输入下载页面超时时间' }], initialValue: optimizeSpiderForm.timeOut}]"}]})],1)],1)],1),r("a-modal",{attrs:{title:e.isUpdate?"跟新蜘蛛":"新建蜘蛛",width:"50%",maskClosable:!1,visible:e.visible},on:{cancel:function(t){e.visible=!1}}},[r("a-spin",{attrs:{spinning:e.opLoading}},[r("a-steps",{style:{marginBottom:"28px"},attrs:{current:e.currentStep,size:"small"}},[r("a-step",{attrs:{title:"基本信息"}}),r("a-step",{attrs:{title:"配置字段规则"}})],1),r("a-form",{attrs:{form:e.form}},[r("a-form-item",[r("span",{staticStyle:{color:"red"}},[e._v("建议先查看文档再操作：")]),r("a",{attrs:{href:"http://doc.lomoye.top/guide/doc.html",target:"_blank"}},[e._v("点我查看文档")])]),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.currentStep,expression:"currentStep === 0"}]},[r("a-form-item",{attrs:{label:"蜘蛛名","label-col":{span:5},"wrapper-col":{span:19}}},[r("a-row",[r("a-col",{attrs:{span:15}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入蜘蛛名"}],initialValue:e.form.name}],expression:"['name', {rules: [{ required: true, message: '请输入蜘蛛名' }], initialValue: form.name}]"}]})],1)],1)],1),r("a-form-item",{attrs:{label:"表名","label-col":{span:5},"wrapper-col":{span:19}}},[r("a-row",[r("a-col",{attrs:{span:15}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["tableName",{rules:[{required:!0,message:"请输入表名"}],initialValue:e.form.tableName}],expression:"['tableName', {rules: [{ required: true, message: '请输入表名' }], initialValue: form.tableName}]"}],attrs:{disabled:e.isUpdate}})],1)],1)],1),r("a-form-item",{attrs:{label:"启用JS渲染","label-col":{span:5},"wrapper-col":{span:19}}},[r("a-row",[r("a-col",{attrs:{span:15}},[[r("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["isDynamic",{rules:[],initialValue:e.form.isDynamic?e.form.isDynamic:0}],expression:"['isDynamic', {rules: [], initialValue: form.isDynamic ? form.isDynamic : 0 }]"}],attrs:{name:"radioGroup","default-value":0}},[r("a-radio",{attrs:{value:0}},[e._v("\n                      否\n                    ")]),r("a-radio",{attrs:{value:1}},[e._v("\n                      是\n                    ")])],1)]],2)],1)],1),r("a-form-item",{attrs:{label:"入口页","label-col":{span:5},"wrapper-col":{span:19}}},[r("a-row",[r("a-col",{attrs:{span:15}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["entryUrl",{rules:[{required:!0,message:"请输入入口页"}],initialValue:e.form.entryUrl}],expression:"['entryUrl', {rules: [{ required: true, message: '请输入入口页' }], initialValue: form.entryUrl}]"}]})],1),r("a-col",{attrs:{span:9}},[r("a-button",{staticClass:"m-l-24",attrs:{type:"dashed",size:"small"},on:{click:function(t){e.testPage(e.form.getFieldValue("entryUrl"),e.form.getFieldValue("isDynamic"))}}},[r("i",{staticClass:"iconfont icon-debug"})])],1)],1)],1),r("a-form-item",{attrs:{label:"列表页正则","label-col":{span:5},"wrapper-col":{span:19}}},[r("a-row",[r("a-col",{attrs:{span:15}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["listRegex",{rules:[{required:!0,message:"请输入列表页正则"}],initialValue:e.form.listRegex}],expression:"['listRegex', {rules: [{ required: true, message: '请输入列表页正则' }], initialValue: form.listRegex}]"}]})],1),r("a-col",{attrs:{span:9}},[r("a-button",{staticClass:"m-l-24",attrs:{type:"dashed",size:"small"},on:{click:function(t){e.testRegex(e.form.getFieldValue("entryUrl"),e.form.getFieldValue("listRegex"),e.form.getFieldValue("isDynamic"))}}},[r("i",{staticClass:"iconfont icon-debug"})])],1)],1)],1),r("a-form-item",{attrs:{label:"正文页XPATH","label-col":{span:5},"wrapper-col":{span:19}}},[r("a-row",[r("a-col",{attrs:{span:15}},[r("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["contentXpath",{rules:[{required:!1}],initialValue:e.form.contentXpath}],expression:"['contentXpath', {rules: [{ required: false }], initialValue: form.contentXpath}]"}]})],1),r("a-col",{attrs:{span:9}},[r("a-button",{staticClass:"m-l-24",attrs:{type:"dashed",size:"small"},on:{click:function(t){e.testXpath(e.form.getFieldValue("entryUrl"),e.form.getFieldValue("contentXpath"),e.form.getFieldValue("isDynamic"))}}},[r("i",{staticClass:"iconfont icon-debug"})])],1)],1)],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentStep,expression:"currentStep === 1"}]},[r("div",[r("h1",[e._v("列表页字段")]),e.isUpdate?e._e():r("a-button",{staticClass:"m-b-8",attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增列表页字段")]),r("a-table",{attrs:{pagination:!1,bordered:"",rowKey:function(e){return e.index},dataSource:e.dataSource,columns:e.fields},scopedSlots:e._u([{key:"key",fn:function(t,a){return[r("a-input",{attrs:{value:t,placeholder:"",disabled:e.isUpdate},on:{change:function(t){return e.handleFieldChange(a.index,"key",t)}}})]}},{key:"value",fn:function(t,a){return[r("a-input",{attrs:{value:t,placeholder:""},on:{change:function(t){return e.handleFieldChange(a.index,"value",t)}}})]}},{key:"operation",fn:function(t,a){return[r("a-button",{attrs:{type:"dashed",size:"small"},on:{click:function(t){e.testXpath(e.form.getFieldValue("entryUrl"),a.value,e.form.getFieldValue("isDynamic"))}}},[r("i",{staticClass:"iconfont icon-debug"})]),r("a-popover",{ref:"guess"+a.index,attrs:{title:"联想xpath",trigger:"click"}},[r("div",{attrs:{slot:"content"},slot:"content"},[e.showXpaths?e._e():r("div",{staticClass:"guessBox"},[r("a-input",{attrs:{value:t,placeholder:"请输入网页中包含的文字"},model:{value:e.guessContent,callback:function(t){e.guessContent=t},expression:"guessContent"}}),r("a-button",{staticClass:"m-t-8",attrs:{type:"primary"},on:{click:function(t){e.guessXpath(e.form.getFieldValue("entryUrl"),e.guessContent,e.form.getFieldValue("isDynamic"))}}},[e._v("联想")])],1),e.showXpaths?r("div",[e._l(e.xpaths,(function(t,n){return r("div",{key:n},[r("a-card",{staticStyle:{width:"300px"}},[e._v("\n                          "+e._s(t.length>20?t.substring(0,20)+"...":t)+"\n                          "),r("div",[r("a-button",{staticClass:"m-t-8",staticStyle:{"background-color":"#67C23A",border:"none"},attrs:{size:"small",type:"primary"},on:{click:function(a){e.testXpath(e.form.getFieldValue("entryUrl"),t,e.form.getFieldValue("isDynamic"))}}},[e._v("测试")]),r("a-button",{staticClass:"m-t-8 m-l-8",attrs:{size:"small",type:"primary"},on:{click:function(r){return e.chooseXpath(t,a.index)}}},[e._v("选择")])],1)])],1)})),e.xpaths.length?e._e():r("div",[e._v("\n                        未能联想到xpath规则！\n                      ")])],2):e._e()]),r("a-button",{staticClass:"m-l-8",attrs:{type:"dashed",size:"small"},on:{click:function(t){e.xpaths=[],e.showXpaths=!1}}},[e._v("联想xpath")])],1),e.isUpdate?e._e():r("a-button",{staticClass:"m-l-8",attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.handleDelete(a.index)}}},[r("i",{staticClass:"iconfont icon-shanchu text-danger"})])]}}])})],1),r("a-divider"),r("div",[r("h1",[e._v("正文页字段")]),e.isUpdate?e._e():r("a-button",{staticClass:"m-b-8",attrs:{type:"primary"},on:{click:e.handleAddContentField}},[e._v("新增正文页字段")]),r("a-table",{attrs:{pagination:!1,bordered:"",rowKey:function(e){return e.index},dataSource:e.contentDataSource,columns:e.contentFields},scopedSlots:e._u([{key:"key",fn:function(t,a){return[r("a-input",{attrs:{value:t,placeholder:"",disabled:e.isUpdate},on:{change:function(t){return e.handleContentFiledChange(a.index,"key",t)}}})]}},{key:"value",fn:function(t,a){return[r("a-input",{attrs:{value:t,placeholder:""},on:{change:function(t){return e.handleContentFiledChange(a.index,"value",t)}}})]}},{key:"operation",fn:function(t,a){return[r("a-button",{staticClass:"m-l-24",attrs:{type:"dashed",size:"small"},on:{click:function(t){e.testContentXpath(e.form.getFieldValue("entryUrl"),e.form.getFieldValue("contentXpath"),a.value,e.form.getFieldValue("isDynamic"))}}},[r("i",{staticClass:"iconfont icon-debug"})]),e.isUpdate?e._e():r("a-button",{staticClass:"m-l-24",attrs:{type:"dashed",size:"small"},on:{click:function(t){return e.handleContentDelete(a.index)}}},[r("i",{staticClass:"iconfont icon-shanchu text-danger"})])]}}])})],1)],1)],1)],1),r("template",{slot:"footer"},[e.currentStep>0?r("a-button",{key:"back",style:{float:"left"},on:{click:e.backward}},[e._v("上一步")]):e._e(),r("a-button",{key:"cancel",on:{click:function(t){e.visible=!1}}},[e._v("取消")]),r("a-button",{key:"forward",attrs:{loading:e.opLoading,type:"primary"},on:{click:function(t){return e.handleNext(e.currentStep)}}},[e._v(e._s(1===e.currentStep?"完成":"下一步"))])],1)],2),r("a-modal",{attrs:{title:"配置代理",width:"50%",maskClosable:!1,visible:e.configProxyDialog},on:{ok:e.doConfigProxy,cancel:function(t){e.configProxyDialog=!1}}},[r("div",{staticClass:"proxy-list"},e._l(e.proxies,(function(t){return r("a-card",{key:t.id,staticClass:"proxy",attrs:{hoverable:""},on:{click:function(a){return e.chooseProxy(t)}}},[t.selected?r("div",{staticClass:"cover"},[e._v("选中")]):e._e(),r("img",{attrs:{slot:"cover",alt:"example",src:a("dd04")},slot:"cover"}),r("template",{staticClass:"ant-card-actions",slot:"actions"}),r("a-card-meta",{attrs:{title:t.alias,description:"IP提取码："+t.token}})],2)})),1)]),r("a-modal",{attrs:{title:"测试结果",maskClosable:!0,footer:null},model:{value:e.testVisible,callback:function(t){e.testVisible=t},expression:"testVisible"}},e._l(e.testResults,(function(t,a){return r("p",{key:a},[e._v(e._s(t))])})),0),r("a-modal",{attrs:{title:"导入配置",width:"50%",maskClosable:!1,visible:e.importVisible},on:{cancel:function(t){e.importVisible=!1}}},[r("a-form",{attrs:{form:e.importForm}},[r("div",[r("a-form-item",{attrs:{label:"蜘蛛配置字符串","label-col":{span:5},"wrapper-col":{span:16}}},[r("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["spider",{rules:[{required:!0,message:"请粘贴蜘蛛配置字符串"}]}],expression:"['spider', {rules: [{ required: true, message: '请粘贴蜘蛛配置字符串' }]}]"}],attrs:{rows:10}})],1)],1)]),r("template",{slot:"footer"},[r("a-button",{key:"cancel",on:{click:function(t){e.importVisible=!1}}},[e._v("取消")]),r("a-button",{key:"forward",attrs:{loading:e.opLoading,type:"primary"},on:{click:e.doImportSpider}},[e._v("导入")])],1)],2),r("a-modal",{attrs:{title:"导出配置",width:"50%",maskClosable:!1,visible:e.exportVisible},on:{cancel:function(t){e.exportVisible=!1}}},[r("div",[e._v("\n      "+e._s(e.spiderJson)+"\n    ")]),r("template",{slot:"footer"},[r("a-button",{key:"cancel",on:{click:function(t){e.exportVisible=!1}}},[e._v("关闭")]),r("a-button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.spiderJson,expression:"spiderJson"},{name:"clipboard",rawName:"v-clipboard:success",value:e.clipboardSuccessHandler,expression:"clipboardSuccessHandler",arg:"success"}],key:"forward",attrs:{type:"primary"}},[e._v("复制")])],1)],2)],1)},n=[],i=(a("2338"),a("fb37"),a("cde0"),a("2559")),o=(a("55a0"),a("f763"),a("608b"),a("7ef6")),s=a.n(o),c=a("3d88");function l(e){if(s()(e))return Object(c["a"])(e)}var u=a("c6d3"),d=a.n(u),p=a("4ec6"),m=a.n(p),f=a("d6b2"),h=a.n(f);function b(e){if("undefined"!==typeof d.a&&null!=e[m.a]||null!=e["@@iterator"])return h()(e)}var g=a("3bb9");function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e){return l(e)||b(e)||Object(g["a"])(e)||v()}a("caaf");var x=a("7c98"),S=a.n(x),w=a("2af9"),k=a("b775");function C(e){return Object(k["b"])({url:"/configurable-spider/search",method:"post",data:e})}function F(e){return Object(k["b"])({url:"/configurable-spider",method:"post",data:e})}function O(e){return Object(k["b"])({url:"/configurable-spider",method:"put",data:e})}function j(e){return Object(k["b"])({url:"/configurable-spider/settings",method:"put",data:e})}function D(e){return Object(k["b"])({url:"/configurable-spider/config-proxy",method:"post",data:e})}function _(e){return Object(k["b"])({url:"configurable-spider/export/".concat(e),method:"post"})}function V(e){return Object(k["b"])({url:"configurable-spider/".concat(e),method:"delete"})}function z(e,t){return Object(k["b"])({url:"configurable-spider/test-page",method:"post",data:{url:e,isDynamic:t}})}function N(e,t,a){return Object(k["b"])({url:"configurable-spider/test-xpath",method:"post",data:{url:e,xpath:t,isDynamic:a}})}function T(e,t,a){return Object(k["b"])({url:"configurable-spider/guess-xpath",method:"post",data:{url:e,content:t,isDynamic:a}})}function I(e,t,a){return Object(k["b"])({url:"configurable-spider/test-regex",method:"post",data:{url:e,regex:t,isDynamic:a}})}function P(e,t,a,r){return Object(k["b"])({url:"configurable-spider/test-content-xpath",method:"post",data:{entryUrl:e,contentXpath:t,xpath:a,isDynamic:r}})}var R=a("76fe"),q=a("17eb4");a("07c3"),a("85ee");function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var J={pageNo:1,pageSize:10,count:0},$=[{title:"蜘蛛名",dataIndex:"name"},{title:"表名",dataIndex:"tableName"},{title:"代理",dataIndex:"proxy",scopedSlots:{customRender:"proxy"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],L={name:"SpiderList",components:{Ellipsis:w["c"]},data:function(){return{currentStep:0,mdl:{},advanced:!1,searchModel:S.a.cloneDeep(J),data:[],columns:$,pagination:{},loading:!1,visible:!1,importVisible:!1,exportVisible:!1,spiderJson:"",importForm:this.$form.createForm(this),opLoading:!1,form:this.$form.createForm(this),stepForms:[["name","tableName","entryUrl","listRegex"]],index:0,fields:[{title:"字段",dataIndex:"key",scopedSlots:{customRender:"key"}},{title:"XPATH规则",dataIndex:"value",scopedSlots:{customRender:"value"}},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],dataSource:[],isUpdate:!1,contentIndex:0,contentDataSource:[],contentFields:[{title:"字段",dataIndex:"key",scopedSlots:{customRender:"key"}},{title:"XPATH规则",dataIndex:"value",scopedSlots:{customRender:"value"}},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],optimizeDialog:!1,optimizeSpiderForm:this.$form.createForm(this),proxyForm:{},configProxyDialog:!1,proxies:[],testResults:[],testVisible:!1,xpaths:[],showXpaths:!1,guessContent:""}},mounted:function(){this.listProxy(!0)},methods:{chooseXpath:function(e,t){var a=y(this.dataSource),r=a.find((function(e){return e.index===t}));r&&(r.value=e,this.dataSource=a),this.$refs["guess"+t].$children[0].sVisible=!1},testContentXpath:function(e,t,a,r){var n=this;e&&t&&a&&P(e,t,a,r).then((function(e){e.success&&(n.testVisible=!0,n.testResults=e.data)}))},testPage:function(e,t){var a=this;e&&z(e,t).then((function(e){e.success&&(a.testVisible=!0,a.testResults=[e.data])}))},guessXpath:function(e,t,a){var r=this;e&&t&&(this.xpaths=[],T(e,t,a).then((function(e){e.success&&(r.showXpaths=!0,r.xpaths=e.data)})))},testXpath:function(e,t,a){var r=this;e&&t&&N(e,t,a).then((function(e){e.success&&(r.testVisible=!0,r.testResults=e.data)}))},testRegex:function(e,t,a){var r=this;e&&t&&I(e,t,a).then((function(e){e.success&&(r.testVisible=!0,r.testResults=e.data)}))},chooseProxy:function(e){var t=this;this.proxyForm.proxyChannelId=e.id,this.proxies.forEach((function(a){a.id===e.id?a.selected?(a.selected=!1,t.proxyForm.proxyChannelId=null):a.selected=!0:a.selected=!1})),this.proxies=y(this.proxies)},doConfigProxy:function(){var e=this,t={id:this.proxyForm.id,proxyChannelId:this.proxyForm.proxyChannelId};D(t).then((function(t){t.success?(e.$message.success("配置成功"),e.configProxyDialog=!1,e.search()):e.$message.error(t.resultMessage)}))},listProxy:function(e){var t=this;Object(q["b"])({}).then((function(a){if(a.success){var r=a.data;r.forEach((function(e){e.id===t.proxyForm.proxyChannelId?e.selected?e.selected=!1:e.selected=!0:e.selected=!1})),t.proxies=r,e&&t.search()}}))},configSpiderProxy:function(e){this.proxyForm=X({},e),this.configProxyDialog=!0,this.listProxy()},optimizeSpider:function(e){this.optimizeSpiderForm=this.$form.createForm(this),this.optimizeSpiderForm=X(X({},this.optimizeSpiderForm),e),this.optimizeDialog=!0},doOptimizeSpider:function(){var e=this;this.optimizeSpiderForm.validateFields((function(t,a){if(!t){var r={id:e.optimizeSpiderForm.id,threadNum:a.threadNum,sleepTime:a.sleepTime,retryTimes:a.retryTimes,retrySleepTime:a.retrySleepTime,cycleRetryTimes:a.cycleRetryTimes,timeOut:a.timeOut};j(r).then((function(t){t.success&&(e.$message.success("设置成功"),e.search(),e.optimizeDialog=!1)})).catch((function(e){console.log(e)}))}}))},openCreateSpider:function(){this.visible=!0,this.form=this.$form.createForm(this),this.dataSource=[],this.index=0,this.isUpdate=!1,this.currentStep=0,this.contentIndex=0,this.contentDataSource=[]},modifySpiderConfig:function(e){this.visible=!0,this.form=this.$form.createForm(this),this.form=X(X({},this.form),e),this.dataSource=JSON.parse(this.form.fieldsJson),this.index=this.dataSource[this.dataSource.length-1].index,this.isUpdate=!0,this.currentStep=0,this.form.contentFieldsJson&&(this.contentDataSource=JSON.parse(this.form.contentFieldsJson),this.contentDataSource&&this.contentDataSource.length&&(this.contentIndex=this.contentDataSource[this.contentDataSource.length-1].index))},cloneSpiderConfig:function(e){this.visible=!0,this.form=this.$form.createForm(this),this.form=X(X({},this.form),e),this.dataSource=JSON.parse(this.form.fieldsJson),this.index=this.dataSource[this.dataSource.length-1].index,this.isUpdate=!1,this.currentStep=0,this.form.contentFieldsJson&&(this.contentDataSource=JSON.parse(this.form.contentFieldsJson),this.contentDataSource&&this.contentDataSource.length&&(this.contentIndex=this.contentDataSource[this.contentDataSource.length-1].index))},deleteSpider:function(e){var t=this;V(e.id).then((function(e){e.success&&(t.$message.success("删除成功"),t.search())}))},goPage:function(e){this.$router.push(e)},copySpiderConfig:function(e){var t=this;_(e.id).then((function(e){e.success&&(t.spiderJson=JSON.stringify(e.data),t.$message.success("导出成功，快去复制吧~"),t.exportVisible=!0)}))},clipboardSuccessHandler:function(){this.$message.success("复制成功!")},runSpider:function(e){var t=this;Object(R["a"])({configurableSpiderId:e.id}).then((function(e){e.success&&(t.$message.success("运行成功"),t.$router.push("/spider/jobRecord/".concat(e.data.id)))}))},doImportSpider:function(){var e=this;this.opLoading=!0,this.importForm.validateFields((function(t,a){if(!t){var r=S.a.cloneDeep(JSON.parse(a.spider));F(r).then((function(t){t.success&&(e.$message.success("新建成功"),e.importVisible=!1,e.importForm.resetFields(),e.search()),e.opLoading=!1})).catch((function(t){console.log(t),e.opLoading=!1}))}}))},handleAddContentField:function(){var e=this.contentIndex,t=this.contentDataSource,a={index:e+1,key:"",value:""};this.contentIndex++,this.contentDataSource=[].concat(y(t),[a])},handleAdd:function(){var e=this.index,t=this.dataSource,a={index:e+1,key:"",value:""};this.index++,this.dataSource=[].concat(y(t),[a])},handleDelete:function(e){this.dataSource.splice(this.dataSource.findIndex((function(t){return t.index===e})),1)},handleContentDelete:function(e){this.contentDataSource.splice(this.contentDataSource.findIndex((function(t){return t.index===e})),1)},handleFieldChange:function(e,t,a){var r=y(this.dataSource),n=r.find((function(t){return t.index===e}));n&&(n[t]=a.target.value,this.dataSource=r)},handleContentFiledChange:function(e,t,a){var r=y(this.contentDataSource),n=r.find((function(t){return t.index===e}));n&&(n[t]=a.target.value,this.contentDataSource=r)},backward:function(){this.currentStep--},handleNext:function(e){var t=this,a=e+1;a<=1?this.form.validateFields(this.stepForms[this.currentStep],(function(e,r){e||(t.currentStep=a)})):(this.opLoading=!0,this.form.validateFields((function(e,a){if(e)t.opLoading=!1;else{var r=S.a.cloneDeep(a);r.fieldsJson=JSON.stringify(t.dataSource),r.contentFieldsJson=JSON.stringify(t.contentDataSource),t.isUpdate?(r.id=t.form.id,O(r).then((function(e){e.success&&(t.$message.success("跟新成功"),t.visible=!1,t.form.resetFields(),t.dataSource=[],t.index=0,t.contentDataSource=[],t.contentIndex=0,t.currentStep=0,t.search()),t.opLoading=!1})).catch((function(e){console.log(e),t.opLoading=!1}))):F(r).then((function(e){e.success&&(t.$message.success("新建成功"),t.visible=!1,t.form.resetFields(),t.dataSource=[],t.index=0,t.contentDataSource=[],t.contentDataSource=0,t.currentStep=0,t.search()),t.opLoading=!1})).catch((function(e){console.log(e),t.opLoading=!1}))}})))},toggleAdvanced:function(){this.advanced=!this.advanced},handleTableChange:function(e,t,a){var r=X({},this.pagination);r.current=e.current,this.pagination=r,this.getList(e.current)},search:function(){this.getList(1)},getList:function(e){var t=this;this.loading=!0,void 0!=e&&(this.searchModel.pageNo=e);var a=S.a.cloneDeep(this.searchModel);C(a).then((function(e){if(e.success){t.data=e.data;var a=X({},t.pagination);a.total=e.count,t.pagination=a}t.loading=!1}))}}},A=L,M=(a("8f29"),a("4ac2")),E=Object(M["a"])(A,r,n,!1,null,null,null);t["default"]=E.exports},dd04:function(e,t,a){e.exports=a.p+"img/data5u.a08ddfa1.jpg"}}]);